<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Temperature map</title>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.css" rel="stylesheet">
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.js"></script>
        <style>
            body { margin: 0; padding: 0; }
            #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script src="./dist/interpolateHeatmapLayer.js"></script>
        <script>

            mapboxgl.accessToken = 'pk.eyJ1IjoibW9oaS1nYXRlIiwiYSI6ImNsbjRsdDhvcTAxeWgycXBmcTVjYjA4em4ifQ.yaTzeNt2gbG3Z_a-SkxmTQ';

            // Replace the following URL with the URL of your GeoJSON file on GitHub
            const geoJsonUrl = 'https://raw.githubusercontent.com/GATE-Institute-Future-Cities/sofia-sensors/master/EXEA%20DATA/heatmap_geojson_file.geojson';

            (async () => {
                const response = await fetch(geoJsonUrl);
                const geoJsonData = await response.json();

                // Extract points from GeoJSON features
                const points = geoJsonData.features.map(feature => ({
                    lng: feature.geometry.coordinates[0],
                    lat: feature.geometry.coordinates[1],
                    val: feature.properties.value,
                }));

                const map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/light-v10',
                    center: [23.23, 42.622], // Set the initial center based on your data
                    zoom: 12, // Adjust the initial zoom level as needed
                });

                // When the map is loaded, create and add the heatmap layer
                map.on('load', () => {
                    const layer = interpolateHeatmapLayer.create({
                        points: points,
                        layerId: 'temperature',
                        roi: [
                        {lat: 42.826708, lon: 23.201345},
                        {lat: 42.826708, lon: 23.509432},
                        {lat: 42.57681, lon: 23.509432},
                        {lat: 42.57681, lon: 23.201345},
                        {lat: 42.826708, lon: 23.201345}
                        ],
                        'layout': {
                            'visibility':'none'
                          },

                    });
                    map.addLayer(layer);
                });
            })();

        </script>
    </body>
</html>