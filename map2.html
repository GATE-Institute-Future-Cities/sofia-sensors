<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interpolated Heatmap Layer</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
    <script src='https://unpkg.com/@turf/turf'></script>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibW9oaS1nYXRlIiwiYSI6ImNsbjRsdDhvcTAxeWgycXBmcTVjYjA4em4ifQ.yaTzeNt2gbG3Z_a-SkxmTQ';

        var centerCoordinates = [23.23, 42.622];
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: centerCoordinates,
            zoom: 14
        });

        var heatmapData = "https://raw.githubusercontent.com/GATE-Institute-Future-Cities/sofia-sensors/master/EXEA%20DATA/heatmap_geojson_file.geojson";

        // Fetch GeoJSON data
        fetch(heatmapData)
            .then(response => response.json())
            .then(data => {
                var cellSize = 0.01; // Adjust as needed
                var options = { gridType: 'point', property: 'value', units: 'kilometers' };
                var interpolatedData = turf.interpolate(data, cellSize, options);

                map.on('load', function () {
                    map.addLayer({
                        'id': 'heatmap-layer',
                        'type': 'heatmap',
                        'source': {
                            'type': 'geojson',
                            'data': interpolatedData
                        },
                        'paint': {
                            'heatmap-weight': ['get', 'value'],
                            'heatmap-intensity': 1,
                            'heatmap-radius': 0.9,
                            'heatmap-color': [
                                'interpolate',
                                ['linear'],
                                ['heatmap-density'],
                                0, 'rgba(0,0,255,0)',
                                0.2, 'royalblue',
                                0.4, 'cyan',
                                0.6, 'lime',
                                0.8, 'yellow',
                                1, 'red'
                            ],
                            'heatmap-opacity': 0.8
                        }
                    });
                });
            })
            .catch(error => console.error('Error fetching GeoJSON:', error));
    </script>
</body>
</html>
